{% extends "base.html" %}

{% block title %}Subir Videos - SyncDub MVP{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card border-0 shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-upload me-2"></i>
                    Subir Videos para Sincronización
                </h4>
            </div>
            <div class="card-body p-4">
                <!-- Upload Form -->
                <form id="uploadForm" enctype="multipart/form-data">
                    
                    <!-- Nombre personalizado -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="customFilename" class="form-label fw-bold">
                                <i class="fas fa-tag me-2 text-info"></i>
                                Nombre del Archivo Final (Opcional)
                            </label>
                            <input type="text" class="form-control" id="customFilename" name="custom_filename" 
                                   placeholder="mi_pelicula_sincronizada" maxlength="100">
                            <small class="text-muted">Se agregará automáticamente la extensión .mkv</small>
                        </div>
                    </div>

                    <!-- Video Original Section -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-film me-2"></i>
                                Video Original
                            </h5>
                            
                            <!-- Source Selection for Original -->
                            <div class="source-selection mb-3">
                                <h6 class="mb-2">Seleccionar Fuente:</h6>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="original_source" 
                                           id="originalUpload" value="upload" checked>
                                    <label class="form-check-label" for="originalUpload">
                                        <i class="fas fa-upload me-1"></i>
                                        Subir desde mi equipo
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="original_source" 
                                           id="originalVolume" value="volume">
                                    <label class="form-check-label" for="originalVolume">
                                        <i class="fas fa-server me-1"></i>
                                        Seleccionar del servidor
                                    </label>
                                </div>
                            </div>

                            <!-- Upload Area for Original -->
                            <div id="originalUploadArea" class="upload-area mb-3">
                                <input type="file" id="originalVideo" name="original_video" accept="video/*">
                                <div class="upload-content">
                                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                    <h6>Arrastra tu video aquí</h6>
                                    <p class="text-muted mb-2">o haz clic para seleccionar</p>
                                    <small class="text-muted">MP4, AVI, MKV, MOV (máx. 8GB)</small>
                                </div>
                            </div>

                            <!-- Volume Browser for Original -->
                            <div id="originalVolumeArea" class="volume-area d-none">
                                <div class="media-status mb-2">
                                    <div id="originalMediaStatus" class="alert alert-info">
                                        <i class="fas fa-spinner fa-spin me-2"></i>
                                        Verificando disponibilidad del volumen...
                                    </div>
                                </div>
                                <div id="originalBreadcrumb" class="breadcrumb-custom d-none">
                                    <nav aria-label="breadcrumb">
                                        <ol class="breadcrumb mb-0">
                                            <li class="breadcrumb-item">
                                                <a href="#" data-path="" class="navigate-link">
                                                    <i class="fas fa-home"></i> Inicio
                                                </a>
                                            </li>
                                        </ol>
                                    </nav>
                                </div>
                                <div id="originalMediaBrowser" class="media-browser d-none">
                                    <!-- Content loaded dynamically -->
                                </div>
                            </div>

                            <!-- File Info for Original -->
                            <div id="originalFileInfo" class="file-info d-none">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-file-video text-primary me-2"></i>
                                    <div>
                                        <div class="file-name"></div>
                                        <div class="file-size"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Video Doblado Section -->
                        <div class="col-md-6">
                            <h5 class="text-success mb-3">
                                <i class="fas fa-microphone me-2"></i>
                                Video Doblado
                            </h5>
                            
                            <!-- Source Selection for Dubbed -->
                            <div class="source-selection mb-3">
                                <h6 class="mb-2">Seleccionar Fuente:</h6>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="dubbed_source" 
                                           id="dubbedUpload" value="upload" checked>
                                    <label class="form-check-label" for="dubbedUpload">
                                        <i class="fas fa-upload me-1"></i>
                                        Subir desde mi equipo
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="dubbed_source" 
                                           id="dubbedVolume" value="volume">
                                    <label class="form-check-label" for="dubbedVolume">
                                        <i class="fas fa-server me-1"></i>
                                        Seleccionar del servidor
                                    </label>
                                </div>
                            </div>

                            <!-- Upload Area for Dubbed -->
                            <div id="dubbedUploadArea" class="upload-area mb-3">
                                <input type="file" id="dubbedVideo" name="dubbed_video" accept="video/*">
                                <div class="upload-content">
                                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                    <h6>Arrastra tu video aquí</h6>
                                    <p class="text-muted mb-2">o haz clic para seleccionar</p>
                                    <small class="text-muted">MP4, AVI, MKV, MOV (máx. 8GB)</small>
                                </div>
                            </div>

                            <!-- Volume Browser for Dubbed -->
                            <div id="dubbedVolumeArea" class="volume-area d-none">
                                <div class="media-status mb-2">
                                    <div id="dubbedMediaStatus" class="alert alert-info">
                                        <i class="fas fa-spinner fa-spin me-2"></i>
                                        Verificando disponibilidad del volumen...
                                    </div>
                                </div>
                                <div id="dubbedBreadcrumb" class="breadcrumb-custom d-none">
                                    <nav aria-label="breadcrumb">
                                        <ol class="breadcrumb mb-0">
                                            <li class="breadcrumb-item">
                                                <a href="#" data-path="" class="navigate-link">
                                                    <i class="fas fa-home"></i> Inicio
                                                </a>
                                            </li>
                                        </ol>
                                    </nav>
                                </div>
                                <div id="dubbedMediaBrowser" class="media-browser d-none">
                                    <!-- Content loaded dynamically -->
                                </div>
                            </div>

                            <!-- File Info for Dubbed -->
                            <div id="dubbedFileInfo" class="file-info d-none">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-file-video text-success me-2"></i>
                                    <div>
                                        <div class="file-name"></div>
                                        <div class="file-size"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center">
                        <button type="submit" id="submitBtn" class="btn btn-primary btn-lg" disabled>
                            <i class="fas fa-sync-alt me-2"></i>
                            Iniciar Sincronización
                        </button>
                    </div>
                </form>

                <!-- Progress Section -->
                <div id="progressSection" class="progress-container d-none">
                    <h5 class="text-center mb-3">
                        <i class="fas fa-cogs me-2"></i>
                        Procesando Sincronización
                    </h5>
                    <div class="progress mb-3">
                        <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" style="width: 0%"></div>
                    </div>
                    <div id="progressMessage" class="text-center text-muted">
                        Iniciando procesamiento...
                    </div>
                </div>

                <!-- Result Section -->
                <div id="resultSection" class="d-none">
                    <div class="alert alert-success text-center">
                        <h5 class="alert-heading">
                            <i class="fas fa-check-circle me-2"></i>
                            ¡Sincronización Completada!
                        </h5>
                        <p class="mb-3">Tu video ha sido sincronizado exitosamente.</p>
                        <button id="downloadBtn" class="btn btn-success">
                            <i class="fas fa-download me-2"></i>
                            Descargar Video Sincronizado
                        </button>
                    </div>
                </div>

                <!-- Error Section -->
                <div id="errorSection" class="d-none">
                    <div class="alert alert-danger text-center">
                        <h5 class="alert-heading">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Error en el Procesamiento
                        </h5>
                        <p id="errorMessage" class="mb-3">Ha ocurrido un error durante el procesamiento.</p>
                        <button type="button" class="btn btn-outline-danger" onclick="location.reload()">
                            <i class="fas fa-redo me-2"></i>
                            Intentar de Nuevo
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h6>📁 Fuentes de Video:</h6>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-1">
                                <i class="fas fa-upload text-primary me-2"></i>
                                <strong>Subir:</strong> Desde tu equipo local
                            </li>
                            <li class="mb-1">
                                <i class="fas fa-server text-success me-2"></i>
                                <strong>Servidor:</strong> Desde volumen configurado
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h6>⚙️ Configuración:</h6>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-1">
                                <i class="fas fa-tag text-info me-2"></i>
                                Nombre personalizado opcional
                            </li>
                            <li class="mb-1">
                                <i class="fas fa-file-video text-warning me-2"></i>
                                Resultado siempre en formato MKV
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/upload.js') }}"></script>
{% endblock %}

